#!/usr/bin/env bash
set -euo pipefail

TARGET_URL="${1:-http://localhost:8080/index.php}"
PAYLOAD="buffer_overflow_payload"

ENC_PAYLOAD="$(python3 - <<'PY'
import urllib.parse
print(urllib.parse.quote("buffer_overflow_payload", safe=""))
PY
)"

echo "[*] Target: ${TARGET_URL}"
echo "[*] Encoded payload: ${ENC_PAYLOAD}"

SEP='?'
[[ "$TARGET_URL" == *"?"* ]] && SEP='&'
FULL_URL="${TARGET_URL}${SEP}payload=${ENC_PAYLOAD}"

echo "[*] Requesting: $FULL_URL"
curl -v -X GET "$FULL_URL" || true
echo "[+] Exploit attempted on $FULL_URL"

